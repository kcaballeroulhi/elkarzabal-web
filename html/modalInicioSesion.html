<script src="javascript/jshash-2.2/sha1.js" type="text/javascript"></script>
<script>
  const URL = "http://localhost:3000/";
  document.getElementById("login").addEventListener("click", function (e) {
    e = window.event || e;
    if (this === e.target) {
      // put your code here
      cerrarVentanaSesion();
    }
  });

  function getUserData() {
    var name = document.getElementById("user").value;
    var password = document.getElementById("password").value;
    var encryptPass = hex_sha1(password)
    console.log(encryptPass)
    $.ajax({
      method: "POST",
      url: URL + "api/login",
      data: JSON.stringify({ "email": name, "password": encryptPass }),
      contentType: "application/json",
      success: function (data) {
        accessToken = data.accessToken;

        userNumTipe = data.roleId;
        localStorage.removeItem('token')

        localStorage.setItem('token', accessToken);

        //SE CREAN LAS COOKIES
        document.cookie = "user=" + data.name;
        document.cookie = "roleId=" + userNumTipe;
        //FIN DE LAS COOKIES
        switch (userNumTipe) {
          case 1:
            window.open("././adminApp.html", "_self")
            break;
          case 2:
            window.open("././adminApp.html", "_self")
            break;
          case 3:
            window.open("././pedido.html", "_self")
            break;
        }
      },
      error: function (e) {
        document.getElementById("mensajeErrorInicioSesion").innerHTML = "Usuario o contraseña incorrecto"
      }
    });
  }

</script>
<div id="login" class="modal">
  <div id="fondo" class="modal-contenido">
    <div id="cCierreModal"><a id="cierreModal" href="#">X</a></div><br>
    <span id="etiquetaModal">Iniciar sesión</span>
    <hr id="separacionModal">
    <form>
      <label class="separacion2 etiqueta" for="user">Usuario</label>
      <input class="campo" name="user" type="text" id="user" />
    </form><br>
    <label class="etiqueta" for="password">Password</label>
    <input class="campo" name="password" type="password" id="password" /><br>
    <input class="boton" type="submit" value="Acceder" onclick="getUserData()">
    </form>
    <!--MENSAJE DE ERROR PARA EL LOGIN-->
    <span id="mensajeErrorInicioSesion"></span>
  </div>
</div>